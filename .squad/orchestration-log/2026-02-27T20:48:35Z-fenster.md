# Fenster Orchestration — Agent Sandbox Endpoint

**Timestamp:** 2026-02-27T20:48:35Z  
**Agent:** Fenster (Backend)  
**Task:** Implement sandbox chat endpoint for agent testing

## Deliverable

**Commit:** `41829ad` — feat: agent sandbox — chat with agents from the portal

### Changes
- `src/routes/portal.ts`: Added `POST /v1/portal/agents/:id/chat` endpoint
  - Resolves agent hierarchy (agent → tenant → parent chain)
  - Applies system prompt and skills via `applyAgentToRequest`
  - Calls provider non-streaming
  - Returns `{ message, model, usage }`
  - Errors: 400 (invalid request), 404 (agent not found), 502 (provider error)
  - Portal auth gated (JWT, no trace recording)

### Key Decision
**Portal Sandbox Chat Endpoint — No Trace Recording**
- Sandbox chats are developer testing sessions, not production traffic
- Recording would pollute tenant analytics and inflate token cost estimates
- Future trace recording requires explicit `sandbox: true` flag in schema

## Status
✅ Complete
